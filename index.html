<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport">

  <title>Types in Ruby</title>

  <link href="dist/reset.css" rel="stylesheet">
  <link href="dist/reveal.css" rel="stylesheet">
  <link href="dist/theme/white.css" rel="stylesheet">

  <!-- Theme used for syntax highlighted code -->
  <link href="plugin/highlight/atom-one-dark.css" rel="stylesheet">
</head>

<body>
<div class="reveal">
  <div class="slides">
    <section class="text-white" data-background-image="img/background.jpg">
      <h1 class="text-white">Types in Ruby</h1>

      <p>
        <small>
          By Guillaume Briday
        </small>
      </p>
    </section>

    <section>
      <h2>Before starting</h2>

      <ul class="list-point-right">
        <li class="fragment">Quick introduction</li>
        <li class="fragment">Early development</li>
        <li class="fragment">Comparison with other languages</li>
        <li class="fragment">Very complicated and vast world</li>
      </ul>
    </section>

    <section>
      <h2>Why types are cool?</h2>

      <ul class="list-point-right">
        <li class="fragment">Better IDE integration</li>
        <li class="fragment">Give information to other developers</li>
        <li class="fragment">Documentation for the code</li>
        <li class="fragment">Can find bugs during development</li>
        <li class="fragment">etc.</li>
      </ul>

      <p class="fragment">
        <a href="https://www.typescriptlang.org/docs/handbook/typescript-in-5-minutes.html" target="_blank">
          üëâ TypeScript in 5 minutes
        </a>
      </p>
    </section>

    <section>
      <h2>Why types are cool?</h2>

      <p>
        <a
        href="https://www.typescriptlang.org/play/?#code/C4TwDgpgBAygrgMwQSwB4BVzQLxQEQA2yAdhAIYBOeUAPvgLYD2xwAFgSNXXiORR3gBQghHGIBjYMmZQA5hGAAFCsnHQAFAGdEKVAC5YOtJkgBKA8Tj0ARhApQA3oKhRkCKFqOoo2X-iKklHimjs4uUBQKcBTEUACcAHRxcWEAvlAQBJrQbh7aSGg+fnhMLOycIU7hEVExUAAcSSkuqcIukcDRsQDsTYKtwuLMmowEEAkEjLLq8koqauqEJHzBpkA"
        target="_blank"
        >
          üëâ Try it!
        </a>
      </p>
    </section>

    <section>
      <h2>Typesception</h2>

      <p>
        <small class="fragment">
          Different type of types.
        </small>
      </p>

      <ul class="list-point-right">
        <li class="fragment">Static & Dynamic typing</li>
        <li class="fragment">Nominal & Structural typing</li>
        <li class="fragment">Gradual typing</li>
      </ul>

      <aside class="notes">
        <ul>
          <li>C, C++, Java, Go, Rust (Static & Nominal)</li>
          <li>TypeScript (static but Structural)</li>
          <li>PHP, JavaScript, Ruby, Python (Dynamic and/or nominal and Gradual typing)</li>
        </ul>
      </aside>
    </section>

    <section>
      <h2>Static typing</h2>

      <small class="fragment">
        Types are checked at compile time.
      </small>

      <pre class="fragment">
  <code class="language-java" data-trim>
// src/main/java/io/core/person/Person.java

public class Person {
    private String name;
    private int age;

    public Person(String name, int age) {
        this.name = name;
        this.age = age;
    }

    public String getName() {
        return name;
    }
}

public class Main {
    public static void main(String[] args) {
        Person person = new Person("Alice", 30);
    }
}
  </code>
</pre>
    </section>

    <section>
      <h2>Dynamic typing</h2>

      <small class="fragment">
        Types are checked at runtime.
      </small>

      <pre class="fragment">
  <code class="language-ruby" data-trim>
# person.rb

class Person
  def initialize (name, age)
    @name = name
    @age = age
  end
end

person = new Person("Alice", 30)
  </code>
</pre>
    </section>

    <section>
      <h2>Nominal typing</h2>

      <small class="fragment">
        Type is defined by its name.
      </small>

      <pre class="fragment">
  <code class="language-php" data-trim>
class Dog {
  public function speak() {
    return "whoaf";
  }
}

class Cat {
  ...
}

function speak(Dog $animal): void {
  echo $animal->speak();
}

speak(new Dog); ‚úÖ //=> "whoaf"
speak(new Cat); ‚ùå Uncaught TypeError: speak(): Argument #1 ($animal) must be of type Dog, Cat given.
  </code>
</pre>
    </section>

    <section>
      <h2>Structural typing</h2>

      <small class="fragment">
        Type is defined by its structure.
      </small>

      <pre class="fragment">
  <code class="language-typescript" data-trim>
class Dog {
  speak () {
    return 'whoaf'
  }
}

const Cat = {
  speak () {
    return 'miaou'
  }
}

function speak (animal: Dog) {
  console.log(animal.speak())
}

speak(new Dog) ‚úÖ //=> "whoaf"
speak(Cat) ‚úÖ //=> "miaou"
  </code>
</pre>

      <p class="fragment">
        <a
        href="https://www.typescriptlang.org/play/?#code/MYGwhgzhAEAiD2BzaBvAUNaEAOBTMA1tABQCUqGm0ATrgC4Cu1AdtAOQDuAFvGAGZtKAXzQi0weMwh1oAYTAyAvBUw58RMiqq1GLdgFsAlmHgNBmEWL4NmwOoclY8hEmGaH9YEAC44ScuiYElLwILgAdCBIxG4eXuFqhGSkomhoiQTEzLgcfojk6c6Z8nSkQA"
        target="_blank">
          üëâ Try it!
        </a>
      </p>
    </section>

    <section>
      <h2>Gradual typing</h2>

      <small class="fragment">
        Best of both worlds.
      </small>

      <ul class="list-point-right">
        <li class="fragment">Gradually add static typing to dynamic languages</li>
        <li class="fragment">Types are checked by linters</li>
        <li class="fragment">Types are reported at runtime</li>
        <li class="fragment">Nominal or Structural</li>
      </ul>

      <p class="fragment">
        <a
        href="https://www.typescriptlang.org/play/?#code/GYVwdgxgLglg9mABAQwCaoBTIFyLCAWwCMBTAJwBpEjd9jyBKRAbwChFEySoQyllEAamqsAvq1YQEAZzgAbEgDo5cAOZZ0GAExUAzAwZA"
        target="_blank">
          üëâ Playground
        </a>
      </p>

      <aside class="notes">
        <ul>
          <li>PHP, TypeScript, Python, etc</li>
          <li>TypeScript is transpiled, not compiled</li>
          <li>See types.php as example</li>
        </ul>
      </aside>
    </section>

    <section>
      <h2>What about Ruby? üíé</h2>

      <small class="fragment">
        It's all about Duck Typing.
      </small>


      <div class="d-flex align-items-center gap-4">
        <blockquote class="fragment">
          "If it walks like a duck, and it quacks like a duck, then it must be a duck"
        </blockquote>

        <img alt="Duck typing" class="fragment" src="img/duck-typing.jpg" width="400">
      </div>
    </section>

    <section>
      <h2>What about Ruby? üíé</h2>

      <p>
        Duck typing is about defining objects by <strong>what they do</strong> instead of <strong>who they are</strong>.
      </p>

      <aside class="notes">
        <ul>
          <li>Show interface in types.php example</li>
        </ul>
      </aside>
    </section>

    <section>
      <h2>Duck typing in real life ü¶Ü</h2>

      <pre>
  <code class="language-ruby" data-trim>
class Trip
  def prepare(preparers)
    preparers.each do |preparer|
      case preparer
      when Mechanic then preparer.prepare_bicycles(bicycles)
      when TripCoordinator then preparer.buy_food(customers)
      when Driver
        preparer.gas_up(vehicle)
        preparer.fill_water_tank(vehicle)
      end
    end
  end
end

class Mechanic
  def prepare_bicycles(bicycles)
    #...
  end
end

class TripCoordinator
  def buy_food(customers)
    # ...
  end
end

class Driver
  def gas_up(vehicle)
    #...
  end

  def fill_water_tank(vehicle)
    #...
  end
end
  </code>
</pre>
    </section>

    <section>
      <h2>Duck typing in real life ü¶Ü</h2>

      <pre>
  <code class="language-ruby" data-trim>
class Trip
  def prepare(preparers)
    preparers.each do |preparer|
      preparer.prepare_trip(self)
    end
  end
end

# when every preparer is a Duck that responds to ‚Äòprepare_trip‚Äô
class Mechanic
  def prepare_trip(trip)
    prepare_bicycles(trip.bicycles)
  end
end

class TripCoordinator
  def prepare_trip(trip)
    buy_food(trip.customers)
  end
end

class Driver
  def prepare_trip(trip)
    gas_up(trip.vehicle)

    fill_water_tank(trip.vehicle)
  end
end
  </code>
</pre>
    </section>

    <section>
      <h2>Duck typing in real life ü¶Ü</h2>

      <p>
        Enforce it with modules
      </p>

      <pre>
  <code class="language-ruby" data-trim>
module Preparer
  def prepare_trip(trip)
    raise "Not implemented"
  end
end

class Trip
  def prepare(preparers)
    preparers.each do |preparer|
      preparer.prepare_trip(self)
    end
  end
end

class Mechanic
  include Preparer
end

class TripCoordinator
  include Preparer
end

class Driver
  include Preparer
end
  </code>
</pre>
    </section>

    <section>
      <h2>Duck typing in real life ü¶Ü</h2>

      <pre>
  <code class="language-ruby" data-trim>
def import_state_badge(import)
  variant = {
    enqueued: :secondary,
    processing: :info,
    error: :danger,
    completed: :success
  }[import.state.to_sym]

  badge_tag(value: import.state.titleize, variant: variant)
end

<%= import_state_badge(@import) %>
<%= import_state_badge(@budget) %>
<%= import_state_badge("completed") %>
  </code>
</pre>

      <p>
        <a
        href="https://www.typescriptlang.org/play/?#code/C4TwDgpgBAysCGwIBVzQLxQOQQHYEcBXCYgEyygB9swAnAewGMIBnFgS1wHMLqdaGtXtkb0AtmAA2EJOQBQoSFABq8Wu3i5gqJZiwsIo3KTUhhWE9whCq2AO5rcnHrf2FGzNuc4AzelgU0KAAlQ3paUh0MKABvOSgoXHgxCAAuKBZgdW54jIQkdLhEFDQ5AF85OR9CXEZgdnpcKAAjeFIuCAB9BC4oAAoYqAA3eEliABphtQ0tKDL0wZGxtLzsrkmR9U1gdNUtrSiygEpY3ISjTKhGSXg2VihMOITnqAAiAyMTWhBX9KxmrgAWi4tHgIEBAEYAAxQqBIAAewGBoPBAA4YVA1siwYCAEwwrDjM7PV6WDq0X7YAGA2gQUiQjEIpG0+no2FYll4glEl4JV4OWhObiU-5AkAQSSSeh2BmwpmA8WS6WAtmY5wKiVSmX4qGE4l8ljuTwsEXUkEQPCyuEQRHIi24FUYrHmy06vW8t6+eimoHNZZW+V+4iO9nqoMQLm64llADamxmwAAupUErTgIRBVAAAYAHlI7CGVxubHQrwAJDFrrcDCwyq8AHwVpbEMo5gD0+aG9az5Uq1Vq9UaUHYEnCwE6mWKnVa7QgfVpogi6VCi8iaBOTyujUu8e2CygMYA1hAQMOmkUkFFE7tptsonMHqcXq88EQSHSRR9Gl8zDySXQmFYDhhXSV4vVeP8+WsQRKVJTRyQg4lXlECRpFkWDDQ8IDXlyCpcjTDMmhnDpungLgBimZZ0gXcJSAAOknJANlvLR0l3LQYxoiIGPyCBEzmI5ezkC5gCgACACtDB2EIwgie9HlyJIUj+ABZU8JKk908mKUDX2IMgcLw4Tt1EzghnodhmGXWS110J9EmSFYsDUs9zMsiAtMYlZkPEKQZA-ISLnoaQ6KlciRzAMcJ146c2g6PoNLqI5BKCkKwr6CKoq82LZwy3A3OYZKgA"
        target="_blank"
        >
          üëâ Try it!
        </a>
      </p>
    </section>

    <section>
      <h2>The problem with Duck Typing ü¶Ü</h2>

      <ul class="list-point-right">
        <li class="fragment">No autocompletion</li>
        <li class="fragment">Types are checked at runtime</li>
        <li class="fragment">Hard to find occurrences</li>
        <li class="fragment">No hint of what you can do or not</li>
      </ul>
    </section>

    <section>
      <h2>The problem with Duck Typing ü¶Ü</h2>

      <img alt="meh" src="img/meh.gif">
    </section>

    <section>
      <h2>Solution in Ruby</h2>

      <small>Basically <code>.d.ts</code> files for Ruby.</small>

      <p>
        <img alt="rbs" src="img/rbs.png">
      </p>
    </section>

    <section>
      <h2>RBS in action</h2>

      <small>
        You ruby code.
      </small>

      <pre>
  <code class="language-ruby" data-trim>
# working_day_calculator.rb

require 'date'

class WorkingDayCalculator
  attr_accessor :period_start, :period_end
  attr_reader :days_off

  def initialize
    @days_off = []
  end

  def add_day_off(date)
    @days_off << date
  end

  def calculate_working_days
    ((period_start..period_end).to_a - days_off).length
  end
end
  </code>
</pre>
    </section>

    <section>
      <h2>RBS in action</h2>

      <small>
        Your declaration file.
      </small>

      <pre>
  <code class="language-ruby" data-trim>
# working_day_calculator.rbs

class WorkingDayCalculator
  attr_accessor period_start: Date
  attr_accessor period_end: Date
  attr_reader days_off: Array[Date]
  def initialize: -> void
  def add_day_off: (Date date) -> Array[Date]
  def calculate_working_days: -> untyped
end
  </code>
</pre>
    </section>

    <section>
      <h2>RBS in action</h2>

      <small>
        Steep is a Static type checker for Ruby.
      </small>

      <pre>
  <code class="language-shell" data-trim>
# Type checking files:

....................................................................................F

working_day_calculator_test.rb:13:17: [error] Cannot pass a value of type `::String` as an argument of type `::Date`
‚îÇ   ::String <: ::Date
‚îÇ     ::Object <: ::Date
‚îÇ       ::BasicObject <: ::Date
‚îÇ
‚îÇ Diagnostic ID: Ruby::ArgumentTypeMismatch
‚îÇ
‚îî calc.add_day_off('BOOM')
                   ~~~~~~~~~~

Detected 1 problem from 1 file
  </code>
</pre>
    </section>

    <section>
      <h2>RBS inline</h2>

      <p>
        <a href="https://github.com/soutaro/rbs-inline" target="_blank">
          https://github.com/soutaro/rbs-inline
        </a>
      </p>

      <pre>
  <code class="language-ruby" data-trim>
# rbs_inline: enabled

class Person
  attr_reader :name #: String

  attr_reader :addresses #: Array[String]

  # @rbs name: String
  # @rbs addresses: Array[String]
  # @rbs return: void
  def initialize(name:, addresses:)
    @name = name
    @addresses = addresses
  end

  def to_s #: String
    "Person(name = #{name}, addresses = #{addresses.join(", ")})"
  end

  # @rbs &block: (String) -> void
  def each_address(&block) #:: void
    addresses.each(&block)
  end
end
  </code>
</pre>
    </section>

    <section>
      <h2>Sorbet üç¶ by Stripe</h2>

      <small>
        Sorbet is a Static type checker for Ruby.
      </small>

      <p>
        <a href="https://sorbet.run/" target="_blank">
          üëâ Try it!
        </a>
      </p>
    </section>

    <section>
      <h2>Conclusion</h2>

      <ul class="list-point-right">
        <li class="fragment">Still early stage of development</li>
        <li class="fragment">But the pace is not great...</li>
        <li class="fragment">It's important for Ruby adoption</li>
        <li class="fragment"><a href="https://github.com/ruby/rbs/wiki/Roadmap">RBS roadmap</a></li>
        <li class="fragment">Far from being production ready</li>
        <li class="fragment">Should copy TypeScript DX</li>
      </ul>
    </section>

    <section>
      <figure class="mb-4">
        <img
          alt="me"
          class="rounded-full"
          src="https://www.gravatar.com/avatar/20d8cf689b975dc2f26bd966284185e7?s=600"
          width="200"
        >

        <figcaption>
          <a href="https://twitter.com/guillaumebriday">@guillaumebriday</a>
        </figcaption>
      </figure>

      <div class="d-flex align-items-center">
        <ul class="list-point-right">
          <li>
            <a href="https://guillaumebriday.fr/links">https://guillaumebriday.fr/links</a>
          </li>
        </ul>

        <p class="">
          <img src="img/qrcode.png" width="300">
        </p>
      </div>
    </section>

    <section>
      <h2>Thanks ! üôè</h2>

      <ul class="list-point-right">
        <li>
          <a href="https://types-in-ruby.guillaumebriday.fr">
            https://types-in-ruby.guillaumebriday.fr
          </a>
        </li>
      </ul>
    </section>
  </div>
</div>

<script src="dist/reveal.js"></script>
<script src="plugin/notes/notes.js"></script>
<script src="plugin/highlight/highlight.js"></script>
<script>
  // More info about initialization & config:
  // - https://revealjs.com/initialization/
  // - https://revealjs.com/config/
  Reveal.initialize({
    hash: true,
    controls: true,
    progress: true,
    history: true,
    slideNumber: true,

    // Learn about plugins: https://revealjs.com/plugins/
    plugins: [RevealHighlight, RevealNotes]
  });
</script>
</body>
</html>


<!-- https://brandur.org/fragments/ruby-typing-2024 -->
<!-- https://github.com/soutaro/steep -->
<!-- https://blog.appsignal.com/2021/01/27/rbs-the-new-ruby-3-typing-language-in-action.html -->
<!-- https://morningcoffee.io/interfaces-in-ruby.html -->
<!-- https://phptoruby.io/advanced/type_hinting_and_duck_typing/ -->
<!-- https://thephp.website/en/issue/php-type-system/ -->
<!-- https://github.com/soutaro/rbs-inline -->
<!-- https://www.rubyfleebie.com/2007/07/09/ruby-is-dynamically-and-strongly-typed/ -->
<!-- https://cek.io/blog/2014/05/02/poodr-ch-5/ -->
<!-- https://johnewart.net/2014/interfaces-in-ruby/ -->
